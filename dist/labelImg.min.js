/**!
 * label-img - v0.0.32
 * image annotation tool with javascript
 *
 * 2020-12-11 15:57:07
 * MIT (c) hold-baby
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).LabelImg=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};var e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var n=Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]};function r(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function i(t){return this instanceof i?(this.v=t,this):new i(t)}var a=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};var u=Object.freeze({__proto__:null,__extends:function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},get __assign(){return e},__rest:function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n},__decorate:function(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},__param:function(t,e){return function(n,r){e(n,r,t)}},__metadata:function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__awaiter:function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))},__generator:function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},__createBinding:n,__exportStar:function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)},__values:r,__read:o,__spread:function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t},__spreadArrays:function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},__await:i,__asyncGenerator:function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),a=[];return r={},u("next"),u("throw"),u("return"),r[Symbol.asyncIterator]=function(){return this},r;function u(t){o[t]&&(r[t]=function(e){return new Promise((function(n,r){a.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=o[t](e)).value instanceof i?Promise.resolve(n.value.v).then(c,f):l(a[0][2],n)}catch(t){l(a[0][3],t)}var n}function c(t){s("next",t)}function f(t){s("throw",t)}function l(t,e){t(e),a.shift(),a.length&&s(a[0][0],a[0][1])}},__asyncDelegator:function(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,o){e[r]=t[r]?function(e){return(n=!n)?{value:i(t[r](e)),done:"return"===r}:o?o(e):e}:o}},__asyncValues:function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=r(t),e={},o("next"),o("throw"),o("return"),e[Symbol.asyncIterator]=function(){return this},e);function o(n){e[n]=t[n]&&function(e){return new Promise((function(r,o){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,o,(e=t[n](e)).done,e.value)}))}}},__makeTemplateObject:function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},__importStar:function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&n(e,t,r);return a(e,t),e},__importDefault:function(t){return t&&t.__esModule?t:{default:t}},__classPrivateFieldGet:function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},__classPrivateFieldSet:function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}}),s={name:"label-img",version:"0.0.32",description:"image annotation tool with javascript",main:"dist/labelImg.js",build:"dist/labelImg.min.js",eg:"example/labelImg.js",scripts:{build:"rollup -c rollup.config.build.js",dev:"rollup -c"},repository:{type:"git",url:"git+https://github.com/hold-baby/label-img.git"},keywords:["labelme","annotate","deep-learning","image-annotation","label-image"],author:"hold-baby",license:"MIT",bugs:{url:"https://github.com/hold-baby/label-img/issues"},homepage:"https://github.com/hold-baby/label-img#readme",devDependencies:{"@rollup/plugin-commonjs":"^17.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^7.1.3","@rollup/plugin-typescript":"^6.1.0","@types/lodash":"^4.14.165",dayjs:"^1.9.7",rollup:"^2.34.2","rollup-plugin-banner2":"^1.0.1","rollup-plugin-terser":"^7.0.2",tslib:"^2.0.3",typescript:"^4.1.2"},dependencies:{lodash:"4.17.20"}},c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}function l(t){var e={exports:{}};return t(e,e.exports),e.exports}var p=l((function(t,e){var n,r;Object.defineProperty(e,"__esModule",{value:!0}),e.antLvs=e.AntLv=e.antMouseEvents=e.EAntMouseEvents=void 0,function(t){t.mousedown="mousedown",t.mouseenter="mouseenter",t.mouseleave="mouseleave",t.mousemove="mousemove",t.mouseout="mouseout",t.mouseover="mouseover",t.mouseup="mouseup",t.dblclick="dblclick",t.click="click",t.auxclick="auxclick",t.contextmenu="contextmenu",t.wheel="wheel"}(n=e.EAntMouseEvents||(e.EAntMouseEvents={})),e.antMouseEvents=Object.keys(n),function(t){t.top="top",t.mid="mid",t.bot=" bot"}(r=e.AntLv||(e.AntLv={})),e.antLvs=Object.keys(r);var o=function(){function t(){this.eventMap={}}return t.prototype.on=function(t,e){var n=t.split("."),r=n[0],o=n[1],i=void 0===o?"mid":o,a=r+"."+i,u={lv:i,type:r,callback:e,target:this},s=this.eventMap;s[a]?s[a].push(u):s[a]=[u]},t.prototype.getEventsByType=function(t,e){var n=e||"mid";return this.eventMap[t+"."+n]||[]},t}();e.default=o})),h=f(u),v=h.__importDefault(p),d=[0,0],y=function(t){function e(e){var n=t.call(this)||this;return n.origin=e||d,n.complate=!1,n.el=null,n}return h.__extends(e,t),e.prototype.load=function(t){var e=this;return this.origin=d,new Promise((function(n,r){e.complate=!1;var o=document.createElement("img");new Promise((function(e,n){var r=t;if(t instanceof File){var o=new FileReader;o.readAsDataURL(t),o.onload=function(t){var n;r=null===(n=t.target)||void 0===n?void 0:n.result,e(r)},o.onerror=function(){throw n(),"图片加载错误"}}else"string"==typeof t&&e(r)})).then((function(t){o.src=t,o.onload=function(){e.complate=!0,e.el=o,n(o)},o.onerror=function(){throw r(),"图片加载错误"}}))}))},e.prototype.getEl=function(){return this.el},e.prototype.getSize=function(){if(this.el){var t=this.el;return[t.width,t.height]}return d},e.prototype.getOrigin=function(){return this.origin},e.prototype.getPosition=function(t){void 0===t&&(t=1);var e=this.getSize(),n=e[0]*t,r=e[1]*t,o=this.origin,i=o[0],a=o[1];return[this.origin,[i+n,a],[i+n,a+r],[i,a+r]]},e.prototype.getRelative=function(t,e){var n=t[0],r=t[1],o=this.origin;return[(n-o[0])/e,(r-o[1])/e]},e.prototype.getRelativePositions=function(t,e){var n=this.getOrigin(),r=n[0],o=n[1];return t.map((function(t){var n=t[0],i=t[1];return[r+n*e,o+i*e]}))},e.prototype.setOrigin=function(t){this.origin=t},e}(v.default),g=Object.defineProperty({default:y},"__esModule",{value:!0}),b=l((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isInCircle=e.getDistance=e.getRectPoints=e.isInSide=void 0;e.isInSide=function(t,e){for(var n=t[0],r=t[1],o=!1,i=0,a=e.length-1;i<e.length;a=i++){var u=e[i][0],s=e[i][1],c=e[a][0],f=e[a][1];s>r!=f>r&&n<(c-u)*(r-s)/(f-s)+u&&(o=!o)}return o};e.getRectPoints=function(t,e){return[t,[e[0],t[1]],e,[t[0],e[1]]]};e.getDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],o=Math.pow(n,2),i=Math.pow(r,2);return Math.abs(Math.sqrt(o+i))};e.isInCircle=function(t,n,r){return e.getDistance(t,n)<r},e.default={isInSide:e.isInSide,getRectPoints:e.getRectPoints,getDistance:e.getDistance,isInCircle:e.isInCircle}}));var _=function(){this.__data__=[],this.size=0};var m=function(t,e){return t===e||t!=t&&e!=e};var w=function(t,e){for(var n=t.length;n--;)if(m(t[n][0],e))return n;return-1},j=Array.prototype.splice;var S=function(t){var e=this.__data__,n=w(e,t);return!(n<0)&&(n==e.length-1?e.pop():j.call(e,n,1),--this.size,!0)};var O=function(t){var e=this.__data__,n=w(e,t);return n<0?void 0:e[n][1]};var P=function(t){return w(this.__data__,t)>-1};var x=function(t,e){var n=this.__data__,r=w(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function I(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}I.prototype.clear=_,I.prototype.delete=S,I.prototype.get=O,I.prototype.has=P,I.prototype.set=x;var T=I;var M=function(){this.__data__=new T,this.size=0};var E=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var A=function(t){return this.__data__.get(t)};var R=function(t){return this.__data__.has(t)},k="object"==typeof c&&c&&c.Object===Object&&c,L="object"==typeof self&&self&&self.Object===Object&&self,D=k||L||Function("return this")(),C=D.Symbol,z=Object.prototype,G=z.hasOwnProperty,F=z.toString,B=C?C.toStringTag:void 0;var $=function(t){var e=G.call(t,B),n=t[B];try{t[B]=void 0;var r=!0}catch(t){}var o=F.call(t);return r&&(e?t[B]=n:delete t[B]),o},N=Object.prototype.toString;var U=function(t){return N.call(t)},H=C?C.toStringTag:void 0;var W=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":H&&H in Object(t)?$(t):U(t)};var q=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var Y,V=function(t){if(!q(t))return!1;var e=W(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},X=D["__core-js_shared__"],J=(Y=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+Y:"";var K=function(t){return!!J&&J in t},Q=Function.prototype.toString;var Z=function(t){if(null!=t){try{return Q.call(t)}catch(t){}try{return t+""}catch(t){}}return""},tt=/^\[object .+?Constructor\]$/,et=Function.prototype,nt=Object.prototype,rt=et.toString,ot=nt.hasOwnProperty,it=RegExp("^"+rt.call(ot).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var at=function(t){return!(!q(t)||K(t))&&(V(t)?it:tt).test(Z(t))};var ut=function(t,e){return null==t?void 0:t[e]};var st=function(t,e){var n=ut(t,e);return at(n)?n:void 0},ct=st(D,"Map"),ft=st(Object,"create");var lt=function(){this.__data__=ft?ft(null):{},this.size=0};var pt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ht=Object.prototype.hasOwnProperty;var vt=function(t){var e=this.__data__;if(ft){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ht.call(e,t)?e[t]:void 0},dt=Object.prototype.hasOwnProperty;var yt=function(t){var e=this.__data__;return ft?void 0!==e[t]:dt.call(e,t)};var gt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ft&&void 0===e?"__lodash_hash_undefined__":e,this};function bt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}bt.prototype.clear=lt,bt.prototype.delete=pt,bt.prototype.get=vt,bt.prototype.has=yt,bt.prototype.set=gt;var _t=bt;var mt=function(){this.size=0,this.__data__={hash:new _t,map:new(ct||T),string:new _t}};var wt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var jt=function(t,e){var n=t.__data__;return wt(e)?n["string"==typeof e?"string":"hash"]:n.map};var St=function(t){var e=jt(this,t).delete(t);return this.size-=e?1:0,e};var Ot=function(t){return jt(this,t).get(t)};var Pt=function(t){return jt(this,t).has(t)};var xt=function(t,e){var n=jt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function It(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}It.prototype.clear=mt,It.prototype.delete=St,It.prototype.get=Ot,It.prototype.has=Pt,It.prototype.set=xt;var Tt=It;var Mt=function(t,e){var n=this.__data__;if(n instanceof T){var r=n.__data__;if(!ct||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Tt(r)}return n.set(t,e),this.size=n.size,this};function Et(t){var e=this.__data__=new T(t);this.size=e.size}Et.prototype.clear=M,Et.prototype.delete=E,Et.prototype.get=A,Et.prototype.has=R,Et.prototype.set=Mt;var At=Et,Rt=function(){try{var t=st(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var kt=function(t,e,n){"__proto__"==e&&Rt?Rt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var Lt=function(t,e,n){(void 0!==n&&!m(t[e],n)||void 0===n&&!(e in t))&&kt(t,e,n)};var Dt=function(t){return function(e,n,r){for(var o=-1,i=Object(e),a=r(e),u=a.length;u--;){var s=a[t?u:++o];if(!1===n(i[s],s,i))break}return e}}(),Ct=l((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n?D.Buffer:void 0,i=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=i?i(n):new t.constructor(n);return t.copy(r),r}})),zt=D.Uint8Array;var Gt=function(t){var e=new t.constructor(t.byteLength);return new zt(e).set(new zt(t)),e};var Ft=function(t,e){var n=e?Gt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var Bt=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},$t=Object.create,Nt=function(){function t(){}return function(e){if(!q(e))return{};if($t)return $t(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var Ut=function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object),Ht=Object.prototype;var Wt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ht)};var qt=function(t){return"function"!=typeof t.constructor||Wt(t)?{}:Nt(Ut(t))};var Yt=function(t){return null!=t&&"object"==typeof t};var Vt=function(t){return Yt(t)&&"[object Arguments]"==W(t)},Xt=Object.prototype,Jt=Xt.hasOwnProperty,Kt=Xt.propertyIsEnumerable,Qt=Vt(function(){return arguments}())?Vt:function(t){return Yt(t)&&Jt.call(t,"callee")&&!Kt.call(t,"callee")},Zt=Array.isArray;var te=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var ee=function(t){return null!=t&&te(t.length)&&!V(t)};var ne=function(t){return Yt(t)&&ee(t)};var re=function(){return!1},oe=l((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n?D.Buffer:void 0,i=(o?o.isBuffer:void 0)||re;t.exports=i})),ie=Function.prototype,ae=Object.prototype,ue=ie.toString,se=ae.hasOwnProperty,ce=ue.call(Object);var fe=function(t){if(!Yt(t)||"[object Object]"!=W(t))return!1;var e=Ut(t);if(null===e)return!0;var n=se.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&ue.call(n)==ce},le={};le["[object Float32Array]"]=le["[object Float64Array]"]=le["[object Int8Array]"]=le["[object Int16Array]"]=le["[object Int32Array]"]=le["[object Uint8Array]"]=le["[object Uint8ClampedArray]"]=le["[object Uint16Array]"]=le["[object Uint32Array]"]=!0,le["[object Arguments]"]=le["[object Array]"]=le["[object ArrayBuffer]"]=le["[object Boolean]"]=le["[object DataView]"]=le["[object Date]"]=le["[object Error]"]=le["[object Function]"]=le["[object Map]"]=le["[object Number]"]=le["[object Object]"]=le["[object RegExp]"]=le["[object Set]"]=le["[object String]"]=le["[object WeakMap]"]=!1;var pe=function(t){return Yt(t)&&te(t.length)&&!!le[W(t)]};var he=function(t){return function(e){return t(e)}},ve=l((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n&&k.process,i=function(){try{var t=r&&r.require&&r.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),de=ve&&ve.isTypedArray,ye=de?he(de):pe;var ge=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},be=Object.prototype.hasOwnProperty;var _e=function(t,e,n){var r=t[e];be.call(t,e)&&m(r,n)&&(void 0!==n||e in t)||kt(t,e,n)};var me=function(t,e,n,r){var o=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var u=e[i],s=r?r(n[u],t[u],u,n,t):void 0;void 0===s&&(s=t[u]),o?kt(n,u,s):_e(n,u,s)}return n};var we=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},je=/^(?:0|[1-9]\d*)$/;var Se=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&je.test(t))&&t>-1&&t%1==0&&t<e},Oe=Object.prototype.hasOwnProperty;var Pe=function(t,e){var n=Zt(t),r=!n&&Qt(t),o=!n&&!r&&oe(t),i=!n&&!r&&!o&&ye(t),a=n||r||o||i,u=a?we(t.length,String):[],s=u.length;for(var c in t)!e&&!Oe.call(t,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Se(c,s))||u.push(c);return u};var xe=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},Ie=Object.prototype.hasOwnProperty;var Te=function(t){if(!q(t))return xe(t);var e=Wt(t),n=[];for(var r in t)("constructor"!=r||!e&&Ie.call(t,r))&&n.push(r);return n};var Me=function(t){return ee(t)?Pe(t,!0):Te(t)};var Ee=function(t){return me(t,Me(t))};var Ae=function(t,e,n,r,o,i,a){var u=ge(t,n),s=ge(e,n),c=a.get(s);if(c)Lt(t,n,c);else{var f=i?i(u,s,n+"",t,e,a):void 0,l=void 0===f;if(l){var p=Zt(s),h=!p&&oe(s),v=!p&&!h&&ye(s);f=s,p||h||v?Zt(u)?f=u:ne(u)?f=Bt(u):h?(l=!1,f=Ct(s,!0)):v?(l=!1,f=Ft(s,!0)):f=[]:fe(s)||Qt(s)?(f=u,Qt(u)?f=Ee(u):q(u)&&!V(u)||(f=qt(s))):l=!1}l&&(a.set(s,f),o(f,s,r,i,a),a.delete(s)),Lt(t,n,f)}};var Re=function t(e,n,r,o,i){e!==n&&Dt(n,(function(a,u){if(i||(i=new At),q(a))Ae(e,n,u,r,t,o,i);else{var s=o?o(ge(e,u),a,u+"",e,n,i):void 0;void 0===s&&(s=a),Lt(e,u,s)}}),Me)};var ke=function(t){return t};var Le=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},De=Math.max;var Ce=function(t,e,n){return e=De(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=De(r.length-e,0),a=Array(i);++o<i;)a[o]=r[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=r[o];return u[e]=n(a),Le(t,this,u)}};var ze=function(t){return function(){return t}},Ge=Rt?function(t,e){return Rt(t,"toString",{configurable:!0,enumerable:!1,value:ze(e),writable:!0})}:ke,Fe=Date.now;var Be=function(t){var e=0,n=0;return function(){var r=Fe(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Ge);var $e=function(t,e){return Be(Ce(t,e,ke),t+"")};var Ne=function(t,e,n){if(!q(n))return!1;var r=typeof e;return!!("number"==r?ee(n)&&Se(e,n.length):"string"==r&&e in n)&&m(n[e],t)};var Ue=function(t){return $e((function(e,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,a&&Ne(n[0],n[1],a)&&(i=o<3?void 0:i,o=1),e=Object(e);++r<o;){var u=n[r];u&&t(e,u,r,i)}return e}))}((function(t,e,n){Re(t,e,n)})),He=Math.floor;var We=function(t,e){var n="";if(!t||e<1||e>9007199254740991)return n;do{e%2&&(n+=t),(e=He(e/2))&&(t+=t)}while(e);return n};var qe=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o};var Ye=function(t){return"symbol"==typeof t||Yt(t)&&"[object Symbol]"==W(t)},Ve=C?C.prototype:void 0,Xe=Ve?Ve.toString:void 0;var Je=function t(e){if("string"==typeof e)return e;if(Zt(e))return qe(e,t)+"";if(Ye(e))return Xe?Xe.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n};var Ke=function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i};var Qe=function(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:Ke(t,e,n)},Ze=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var tn=function(t){return Ze.test(t)};var en=function(t){return function(e){return null==e?void 0:e[t]}}("length"),nn="[\\ud800-\\udfff]",rn="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",on="\\ud83c[\\udffb-\\udfff]",an="[^\\ud800-\\udfff]",un="(?:\\ud83c[\\udde6-\\uddff]){2}",sn="[\\ud800-\\udbff][\\udc00-\\udfff]",cn="(?:"+rn+"|"+on+")"+"?",fn="[\\ufe0e\\ufe0f]?",ln=fn+cn+("(?:\\u200d(?:"+[an,un,sn].join("|")+")"+fn+cn+")*"),pn="(?:"+[an+rn+"?",rn,un,sn,nn].join("|")+")",hn=RegExp(on+"(?="+on+")|"+pn+ln,"g");var vn=function(t){for(var e=hn.lastIndex=0;hn.test(t);)++e;return e};var dn=function(t){return tn(t)?vn(t):en(t)};var yn=function(t){return t.split("")},gn="[\\ud800-\\udfff]",bn="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",_n="\\ud83c[\\udffb-\\udfff]",mn="[^\\ud800-\\udfff]",wn="(?:\\ud83c[\\udde6-\\uddff]){2}",jn="[\\ud800-\\udbff][\\udc00-\\udfff]",Sn="(?:"+bn+"|"+_n+")"+"?",On="[\\ufe0e\\ufe0f]?",Pn=On+Sn+("(?:\\u200d(?:"+[mn,wn,jn].join("|")+")"+On+Sn+")*"),xn="(?:"+[mn+bn+"?",bn,wn,jn,gn].join("|")+")",In=RegExp(_n+"(?="+_n+")|"+xn+Pn,"g");var Tn=function(t){return t.match(In)||[]};var Mn=function(t){return tn(t)?Tn(t):yn(t)},En=Math.ceil;var An=function(t,e){var n=(e=void 0===e?" ":Je(e)).length;if(n<2)return n?We(e,t):e;var r=We(e,En(t/dn(e)));return tn(e)?Qe(Mn(r),0,t).join(""):r.slice(0,t)},Rn=/^\s+|\s+$/g,kn=/^[-+]0x[0-9a-f]+$/i,Ln=/^0b[01]+$/i,Dn=/^0o[0-7]+$/i,Cn=parseInt;var zn=function(t){if("number"==typeof t)return t;if(Ye(t))return NaN;if(q(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=q(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Rn,"");var n=Ln.test(t);return n||Dn.test(t)?Cn(t.slice(2),n?2:8):kn.test(t)?NaN:+t},Gn=1/0;var Fn=function(t){return t?(t=zn(t))===Gn||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Bn=function(t){var e=Fn(t),n=e%1;return e==e?n?e-n:e:0};var $n=function(t){return null==t?"":Je(t)};var Nn,Un=function(t,e,n){t=$n(t);var r=(e=Bn(e))?dn(t):0;return e&&r<e?An(e-r,n)+t:t},Hn=l((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.IDG=void 0;var n=h.__importDefault(Un),r=0,o=function(){function t(t){var e=t||{},n=e.len,o=void 0===n?8:n,i=e.start;r=void 0===i?0:i,this.len=o}return t.prototype.getID=function(){var t=n.default(String(r),this.len,"0");return r++,t},t}();e.default=o,e.IDG=new o})),Wn=l((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.disabled=e.active=e.normal=e.ShapeType=void 0;var n,r,o=h.__importDefault(p),i=h.__importDefault(Ue);!function(t){t.Polygon="Polygon",t.Rect="Rect"}(n=e.ShapeType||(e.ShapeType={})),function(t){t.normal="normal",t.active="active",t.disabled="disabled"}(r||(r={})),e.normal={dotColor:"red",dotRadius:3,lineColor:"#c30",lineWidth:2,fillColor:"pink"},e.active={dotColor:"red",dotRadius:3,lineColor:"transparent",lineWidth:0,fillColor:"#c30"},e.disabled={dotColor:"#ccc",dotRadius:3,lineColor:"transparent",lineWidth:0,fillColor:"#666"};var a={normal:e.normal,active:e.active,disabled:e.disabled},u=function(t){function e(e){var r=t.call(this)||this,o=e.id,u=void 0===o?Hn.IDG.getID():o,s=e.type,c=e.name,f=e.positions,l=e.data,p=e.active,h=void 0!==p&&p,v=e.closed,d=void 0===v||v,y=e.disabled,g=void 0!==y&&y,_=e.insert,m=void 0!==_&&_,w=e.visible,j=void 0===w||w,S=e.showTag,O=void 0===S||S,P=e.max,x=e.tag,I=void 0===x?"":x,T=e.style,M=void 0===T?{}:T;return r.id=u,r.type=s,r.name=c,r.status=g?"disabled":h?"active":"normal",r.positions=f,r.data=l||null,r.style=i.default(a,M),r.closed=d,r.visible=j,r.insert=m,r.showTag=O,r.tag=I,r.max=P,r.type===n.Rect&&(r.insert=!1,2===f.length&&d&&(r.positions=b.getRectPoints(f[0],f[1]))),r}return h.__extends(e,t),e.prototype.getPositions=function(){return this.positions||[]},e.prototype.isOnArc=function(t){var e=this.getPositions(),n=this.getStyle().dotRadius;return e.findIndex((function(e){return b.isInCircle(t,e,n)}))},e.prototype.isOnShape=function(t){return b.isInSide(t,this.getPositions())},e.prototype.isOnLine=function(t){var e=t[0],n=t[1],r=this.getPositions(),o=r[0];r.push(o);var i=null,a=[];r.forEach((function(t,e){var n={idx:e,position:t};i?(a.push([i,n]),i=n):i=n}));var u=a.filter((function(t){var r,o=t[0],i=t[1],a=o.position,u=a[0],s=a[1],c=i.position,f=c[0],l=c[1];return r=s===l?s-5<n&&n<s+5:s<l?s<n&&n<l:l<n&&n<s,(u===f?u-5<e&&e<u+5:u<f?u<e&&e<f:f<e&&e<u)&&r})).map((function(t){var r,o,i=t[0],a=t[1],u=i.position,s=u[0],c=u[1],f=a.position,l=f[0],p=f[1];if(p-c==0)r=e,o=c;else if(l-s==0)r=s,o=n;else{var h=(p-c)/(l-s),v=-h,d=n-v*e;o=v*(r=(d-(c-h*s))/(h-v))+d}return{idx:i.idx,position:[r,o]}})).map((function(e){var n=e.position;return{idx:e.idx,position:n,distance:b.getDistance(n,t)}})).sort((function(t,e){return t.distance-e.distance}))[0];return!!u&&(u.distance<5&&u)},e.prototype.getStyle=function(){return this.style[this.status]},e.prototype.setActive=function(t){return this.isDisabled()||(this.status=t?"active":"normal"),this},e.prototype.isActive=function(){return"active"===this.status},e.prototype.close=function(){return this.closed=!0,this},e.prototype.isClose=function(){return this.closed},e.prototype.disabled=function(){return this.status="disabled",this},e.prototype.isDisabled=function(){return"disabled"===this.status},e.prototype.normal=function(){return this.status="normal",this},e.prototype.hidden=function(){return this.visible=!0,this},e.prototype.isHidden=function(){return!this.visible},e.prototype.isInsert=function(){return this.insert},e.prototype.isShowTag=function(){return this.showTag},e.prototype.tagShow=function(t){this.showTag=void 0===t?!this.showTag:!!t},e.prototype.setTag=function(t){this.tag=t},e.prototype.updatePositions=function(t){return this.positions=t,this},e}(o.default);e.default=u})),qn=function(){function t(){this.shapeMap={}}return t.prototype.add=function(t,e){this.shapeMap[t]||(e.name=t,this.shapeMap[t]=e)},t.prototype.get=function(t){if(this.shapeMap[t])return Object.assign({},this.shapeMap[t]);throw"图形未注册"},t}(),Yn=Object.defineProperty({default:qn},"__esModule",{value:!0});!function(t){t.select="select",t.create="create",t.update="update"}(Nn||(Nn={}));var Vn=function(){function t(){this.eventMap={}}return t.prototype.trigger=function(t,e){var n=this.eventMap[t];n&&n.forEach((function(t){t(e)}))},t.prototype.on=function(t,e){var n=this;return this.eventMap[t]||(this.eventMap[t]=[]),this.eventMap[t].push(e),function(){var r,o=null===(r=n.eventMap[t])||void 0===r?void 0:r.findIndex((function(t){return t===e}));o&&n.eventMap[t]&&n.eventMap[t].splice(o,1)}},t.prototype.config=function(t){this.eventMap=Object.assign(this.eventMap,t)},t}(),Xn=Object.defineProperty({default:Vn},"__esModule",{value:!0}),Jn=h.__importStar(p),Kn=h.__importDefault(g),Qn=h.__importStar(Wn),Zn=h.__importDefault(Yn),tr=h.__importDefault(Xn),er={width:800,height:600,bgColor:"#000"},nr=function(t){function e(e,n){var r=t.call(this)||this;r.container=e,r.options=n||er,r.eventHook=new tr.default;var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=r.options.width,o.height=r.options.height,r.container.append(o),r.canvas=o,r.ctx=i,r.scale=1,r.fontSize=14,r.continuity=!1,r.isGuideLine=!1,r.isTagShow=!0,r.renderLocker=!1,r.offset=[0,0],r.cache=null,r.activeShape=null,r.Image=new Kn.default,r.shapeRegister=new Zn.default,r.drawing=null,r.shapeList=[],r.render(),r.init(),r}return h.__extends(e,t),e.prototype.reset=function(){this.scale=1,this.offset=[0,0],this.cache=null,this.activeShape=null,this.drawing=null,this.shapeList=[]},e.prototype.init=function(){this.initMouseEvent(),this.initGuideLine(),this.initDrawEvent(),this.initShapeEvent(),this.initImageEvent()},e.prototype.initMouseEvent=function(){var t=this;Jn.antMouseEvents.forEach((function(e){var n=t.Image;t.canvas.addEventListener(e,(function(r){var o=[r.offsetX,r.offsetY],i=b.isInSide(o,n.getPosition(t.scale)),a=function(){for(var e=null,r=-1,i=t.shapeList.length;i>0;){var a=t.shapeList[i-1],u=n.getRelative(o,t.scale);if(-1!==(r=a.isOnArc(u))){e=a;break}if(a.isOnShape(u)){e=a;break}i--}return[e,r]},u=a()[0],s={offset:o,isOnImage:i,isPropagation:!0,stopPropagation:function(){s.isPropagation=!1},getTargetShape:a,currentTarget:u},c=r;c.ante=s,Jn.antLvs.forEach((function(r){t.shapeList.forEach((function(t){for(var n=t.getEventsByType(e,r),o=n.length;o;){if(!c.ante.isPropagation){o=0;break}var i=n[o-1],a=i.callback,s=h.__rest(i,["callback"]);u===t&&a(c,s),o--}}));for(var o=n.getEventsByType(e,r),i=o.length;i;){if(!c.ante.isPropagation){i=0;break}var a=o[i-1],s=a.callback,f=h.__rest(a,["callback"]);s(c,f),i--}for(var l=t.getEventsByType(e,r),p=l.length;p;){if(!c.ante.isPropagation){p=0;break}var v=l[p-1];s=v.callback,f=h.__rest(v,["callback"]);s(c,f),p--}}))}))}))},e.prototype.initGuideLine=function(){var t=this;this.on("mousemove.top",(function(e){t.offset=e.ante.offset,t.render()}))},e.prototype.initImageEvent=function(){var t=this,e=[0,0],n=!1,r=this.Image,o=!1;r.on("mousedown.bot",(function(i){if(o=!!i.ante.currentTarget,t.drawing&&"Rect"===t.drawing.type&&!n&&(o=!0),!o&&r.complate){n=!0;var a=i.ante.offset,u=a[0],s=a[1],c=r.getOrigin(),f=c[0],l=c[1];e=[u-f,s-l]}})),r.on("mousemove.bot",(function(i){if(!o&&n){var a=i.ante.offset,u=a[0],s=a[1],c=[u-e[0],s-e[1]];r.setOrigin(c),t.render()}})),r.on("mouseup.bot",(function(){n=!1,o=!1,e=[0,0]})),r.on("mouseout.bot",(function(){n=!1,o=!1,e=[0,0]})),r.on("wheel",(function(e){var n=t.Image;if(n.el){var r=e.ante.offset,o=r[0],i=r[1],a=e.deltaY<0?1:-1,u=Number((.05*a+t.scale).toFixed(2));u<.01&&(u=.01);var s=n.getSize(),c=s[0],f=s[1],l=n.getOrigin(),p=l[0],h=l[1],v=c*t.scale,d=c*u,y=Math.abs(o-p),g=(o-p>0?-1:1)*(y*d/v-y)+p,b=f*t.scale,_=f*u,m=Math.abs(i-h),w=(i-h>0?-1:1)*(m*_/b-m)+h;n.setOrigin([g,w]),t.scale=u,t.render()}}))},e.prototype.initDrawEvent=function(){var t=this,e=[0,0],n=this.Image;this.on("mousedown.top",(function(r){if(t.drawing&&n.el){var o=r.ante,i=o.offset;if(o.isOnImage){var a=n.getRelative(i,t.scale);e=a;var u=t.cache;if(u){if(t.drawing.type===Qn.ShapeType.Polygon){var s=!1;if(u.positions.length>2){var c=u.positions[0],f=u.getStyle();s=b.isInCircle(a,c,f.dotRadius)}if(u.max&&u.positions.length+1>=u.max&&(u.positions.push(a),s=!0),s){console.log(u);var l=t.createShape(t.drawing.name,{positions:u.positions,closed:!1});console.log(l),l.updatePositions(u.positions).close(),t.shapeList.push(l),t.cache=null,t.eventHook.trigger("create",l),t.continuity||t.cancle()}else u.positions.push(a)}}else{var p=[];t.drawing.type===Qn.ShapeType.Polygon?p=[a]:t.drawing.type===Qn.ShapeType.Rect&&(p=[a,a,a,a]);l=t.createShape(t.drawing.name,{positions:p,closed:!1,id:"cache"});t.cache=l}t.render()}}})),this.on("mousemove.top",(function(n){var r=t.cache,o=t.Image;if(t.drawing&&o.complate&&r&&t.drawing.type===Qn.ShapeType.Rect){var i=n.ante.offset,a=o.getRelative(i,t.scale),u=b.getRectPoints(e,a);r.updatePositions(u),t.render()}})),this.on("mouseup.top",(function(){var n,r=t.cache,o=null===(n=t.drawing)||void 0===n?void 0:n.type;if(e=[0,0],o===Qn.ShapeType.Rect&&r&&t.drawing){var i=r.getPositions(),a=t.createShape(t.drawing.name,{positions:i});a.close(),t.shapeList.push(a),t.eventHook.trigger("create",a),t.cache=null,t.continuity||t.cancle(),t.render()}})),this.on("mouseout.top",(function(){}))},e.prototype.initShapeEvent=function(){var t=this,e=[0,0],n=[],r=-1,o=!1;this.on("mousedown.top",(function(i){var a=i.ante,u=a.getTargetShape,s=a.offset;e=s;var c=u(),f=c[0],l=c[1];o=!!f,t.drawing||f&&(f.isDisabled()?t.activeShape=null:(i.ante.stopPropagation(),r=l,n=f.getPositions(),t.activeShape!==f&&function(e){t.loseActive(),e.setActive(!0),t.activeShape=e,t.eventHook.trigger("select",e),t.render()}(f)))})),this.on("mousemove.top",(function(i){if(o&&t.activeShape&&!t.drawing){var a=i.offsetX,u=i.offsetY,s=[a-e[0],u-e[1]],c=[];if(-1===r)c=n.map((function(e){var n=e[0],r=e[1];return[n+s[0]/t.scale,r+s[1]/t.scale]}));else{var f=(c=n.slice())[r];if("Rect"===t.activeShape.type){switch(r){case 1:c[0]=[c[0][0],c[0][1]+s[1]/t.scale],c[2]=[c[2][0]+s[0]/t.scale,c[2][1]];break;case 3:c[0]=[c[0][0]+s[0]/t.scale,c[0][1]],c[2]=[c[2][0],c[2][1]+s[1]/t.scale];break;default:c[r]=[f[0]+s[0]/t.scale,f[1]+s[1]/t.scale]}c=b.getRectPoints(c[0],c[2])}else c[r]=[f[0]+s[0]/t.scale,f[1]+s[1]/t.scale]}t.activeShape.updatePositions(c),t.render()}})),this.on("mouseup.top",(function(t){e=[0,0],r=-1,o=!1}))},e.prototype.load=function(t){var e=this;return this.reset(),new Promise((function(n,r){e.Image.load(t).then((function(t){var r=t.width,o=t.height,i=e.options,a=1;(i.width<r||i.height<o)&&(a=r>o?i.width/r:i.height/o),e.scale=a,e.render(),n(t)}),(function(t){r(t)}))}))},e.prototype.register=function(t,e){this.shapeRegister.add(t,e)},e.prototype.createShape=function(t,e){var n=this.shapeRegister.get(t);return new Qn.default(Object.assign(n,e))},e.prototype.useShape=function(t,e){this.drawing=this.shapeRegister.get(t),this.continuity=!!e},e.prototype.addShape=function(t,e){"number"==typeof e?this.shapeList.splice(e,0,t):this.shapeList.push(t),this.render()},e.prototype.remove=function(t){var e=this.findShapeIndex(t)[0];null!==e&&(this.shapeList.splice(e,1),this.render(),this.eventHook.trigger("update"))},e.prototype.setActive=function(t){this.loseActive(),t.setActive(!0),this.render()},e.prototype.cancle=function(){this.drawing=null,this.continuity=!1,this.cache&&(this.cache=null,this.render())},e.prototype.orderShape=function(t,e){var n=this.findShapeIndex(t),r=n[0],o=n[1];null!==r&&(this.shapeList.splice(r,1),e?this.shapeList.unshift(o):this.shapeList.push(o))},e.prototype.findShapeIndex=function(t){var e=null;if(t instanceof Qn.default){var n=t;e=this.shapeList.findIndex((function(t){return t===n}))}else if("string"==typeof t){var r=t;e=this.shapeList.findIndex((function(t){return t.id===r}))}return[e,null===e?null:this.shapeList[e]]},e.prototype.getShapeList=function(){return this.shapeList},e.prototype.getShapeByName=function(t){return this.shapeList.filter((function(e){return e.name===t}))},e.prototype.loseActive=function(){this.shapeList.forEach((function(t){t.setActive(!1)}))},e.prototype.guideLine=function(t){this.isGuideLine=void 0===t?!this.isGuideLine:!!t,this.render()},e.prototype.tagShow=function(t){this.isTagShow=void 0===t?!this.isTagShow:!!t,this.render()},e.prototype.clearCanvas=function(){var t=this.ctx,e=this.options,n=e.width,r=e.height;t.clearRect(0,0,n,r)},e.prototype.renderBackground=function(){var t=this.ctx,e=this.options,n=e.bgColor,r=e.width,o=e.height;t.fillStyle=n,t.fillRect(0,0,r,o)},e.prototype.renderImage=function(){var t=this.ctx,e=this.Image;if(e&&e.complate){var n=e.getEl(),r=e.getSize(),o=r[0],i=r[1],a=o*this.scale,u=i*this.scale,s=e.getOrigin(),c=s[0],f=s[1];t.drawImage(n,c,f,a,u),t.beginPath(),t.fillStyle="red",t.fillText(a+", "+u,10,550),t.closePath()}},e.prototype.renderGuideLine=function(){var t=this.ctx,e=this.offset,n=e[0],r=e[1];t.beginPath(),t.strokeStyle="red",t.moveTo(0,r),t.lineTo(this.options.width,r),t.moveTo(n,0),t.lineTo(n,this.options.height),t.setLineDash([5]),t.stroke(),t.closePath()},e.prototype.renderShape=function(t){var e=this,n=this.Image;if(!t.isHidden()){var r=this.ctx,o=this.scale,i=t.positions,a=t.getStyle(),u=a.dotColor,s=a.dotRadius,c=a.lineColor,f=a.lineWidth,l=a.fillColor,p=n.getRelativePositions(i,o),h=null;if(r.beginPath(),r.strokeStyle=c,r.lineWidth=f*o,p.forEach((function(e,n){var o=e[0],i=e[1];if(h&&(r.moveTo(h[0],h[1]),r.lineTo(o,i),p.length-1===n&&(t.isClose()||t.type===Qn.ShapeType.Rect))){var a=p[0],u=a[0],s=a[1];r.lineTo(u,s)}h=[o,i]})),r.stroke(),r.closePath(),r.beginPath(),p.forEach((function(t,e){var n=t[0],o=t[1];0===e?r.moveTo(t[0],t[1]):r.lineTo(n,o)})),r.globalAlpha=.7,r.fillStyle=l,r.fill(),r.closePath(),r.globalAlpha=1,p.forEach((function(t){var n=t[0],o=t[1];r.beginPath(),r.fillStyle=u,r.arc(n,o,s*e.scale,0,2*Math.PI),r.fill(),r.closePath()})),this.isTagShow&&t.isShowTag()&&t.tag&&t.isClose()){var v=p[0],d=v[0],y=v[1],g=this.scale,b=a.dotRadius*g,_=t.tag,m=this.fontSize*g,w=m*_.length+2*b,j=m+2*b;r.beginPath(),r.fillStyle=a.dotColor,r.rect(d,y-j-b,w,j),r.fill(),r.closePath(),r.beginPath(),r.fillStyle="#fff",r.font=Math.floor(m)+"px/1 Arial",r.fillText(_,d+b,y-2.5*b),r.closePath()}r.font=Math.floor(this.fontSize)+"px/1 Arial"}},e.prototype.renderCache=function(){this.cache&&this.renderShape(this.cache)},e.prototype.renderShapeList=function(){var t=this,e=this.shapeList;if(e.length){var n=null;e.forEach((function(e){e.isActive()?n=e:t.renderShape(e)})),n&&this.renderShape(n)}},e.prototype.forceRender=function(){this.clearCanvas(),this.renderBackground(),this.renderImage(),this.renderShapeList(),this.renderCache(),this.isGuideLine&&this.renderGuideLine(),this.renderLocker=!1},e.prototype.render=function(){var t=this;this.renderLocker||(this.renderLocker=!0,setTimeout((function(){t.forceRender()}),17))},e}(Jn.default),rr=Object.defineProperty({default:nr},"__esModule",{value:!0}),or=h.__importDefault(s),ir=h.__importDefault(rr),ar=h.__importDefault(Wn),ur=h.__importDefault(Hn);return function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.version=or.default.version,r.author=or.default.author,r}return h.__extends(e,t),e.Shape=ar.default,e.IDGenerator=ur.default,e}(ir.default)}));
